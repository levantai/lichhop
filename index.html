<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form ƒêƒÉng K√Ω L·ªãch H·ªçp - T√°ch Ng√†y & Gi·ªù</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* T√πy ch·ªânh nh·ªè ƒë·ªÉ cƒÉn gi·ªØa form */
      .form-container {
        max-width: 650px;
        margin: 50px auto;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        background-color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="form-container">
        <h2 class="mb-4 text-center text-primary">üìù ƒêƒÉng K√Ω L·ªãch H·ªçp</h2>

        <form id="meetingForm">
          <div class="mb-3">
            <label for="tenhop" class="form-label fw-bold">T√™n cu·ªôc h·ªçp:</label>
            <input
              type="text"
              class="form-control"
              id="tenhop"
              name="tenhop"
              required
            />
          </div>

          <div class="mb-3">
            <label for="phong" class="form-label fw-bold">Ph√≤ng h·ªçp:</label>
            <select
              class="form-select"
              id="phong"
              name="phong_select"
              required
              onchange="toggleOtherRoom(this.value)"
            >
              <option value="">-- Ch·ªçn ph√≤ng h·ªçp --</option>
              <option value="Ph√≤ng h·ªçp 3.6">Ph√≤ng h·ªçp 3.6</option>
              <option value="H·ªôi tr∆∞·ªùng">H·ªôi tr∆∞·ªùng</option>
              <option value="Ph√≤ng truy·ªÅn th·ªëng">Ph√≤ng truy·ªÅn th·ªëng</option>
              <option value="Kh√°c...">Kh√°c...</option>
            </select>

            <input
              type="text"
              class="form-control mt-2"
              id="phongKhac"
              name="phong_input"
              placeholder="Nh·∫≠p t√™n ph√≤ng h·ªçp kh√°c..."
              style="display: none"
              disabled
            />
          </div>

          <div class="row mb-3">
            <label class="form-label fw-bold">Ng√†y gi·ªù h·ªçp:</label>
            <div class="col-6">
              <label for="ngay" class="form-label text-muted small"
                >Ng√†y:</label
              >
              <input
                type="date"
                class="form-control"
                id="ngay"
                name="ngay"
                required
              />
            </div>
            <div class="col-6">
              <label for="gio" class="form-label text-muted small">Gi·ªù:</label>
              <input
                type="time"
                class="form-control"
                id="gio"
                name="gio"
                required
              />
            </div>
          </div>

          <div class="mb-3">
            <label for="chutri" class="form-label fw-bold">Ch·ªß tr√¨:</label>
            <input
              type="text"
              class="form-control"
              id="chutri"
              name="chutri"
              required
            />
          </div>

          <div class="mb-3">
            <label for="thanhphan" class="form-label fw-bold"
              >Th√†nh ph·∫ßn tham d·ª±:</label
            >
            <textarea
              class="form-control"
              id="thanhphan"
              name="thanhphan"
              rows="3"
            ></textarea>
          </div>

          <div class="mb-4">
            <label for="noidung" class="form-label fw-bold"
              >N·ªôi dung/M·ª•c ti√™u:</label
            >
            <textarea
              class="form-control"
              id="noidung"
              name="noidung"
              rows="4"
            ></textarea>
          </div>

          <button type="submit" class="btn btn-success btn-lg w-100">
            L∆∞u L·ªãch H·ªçp
          </button>

          <p
            class="message mt-3 text-center"
            id="formMessage"
            style="display: none"
          ></p>
        </form>
        <!--  -->

        <button id="viewDataBtn" class="btn btn-info btn-lg w-100 mt-3">
          üîé Xem L·ªãch H·ªçp ƒê√£ ƒêƒÉng K√Ω
        </button>

        <!-- <div id="meetingTableContainer" class="mt-4" style="display: none"> -->
        <h4 class="text-secondary mb-3">Danh s√°ch L·ªãch H·ªçp Hi·ªán T·∫°i</h4>
      </div>
    </div>

    <script>
      // ... (To√†n b·ªô h√†m toggleOtherRoom v√† form.addEventListener('submit') c·ªßa b·∫°n ·ªü ƒë√¢y) ...

      // Kh·ªüi t·∫°o c√°c ph·∫ßn t·ª≠ m·ªõi
      const viewDataBtn = document.getElementById("viewDataBtn");
      const tableContainer = document.getElementById("meetingTableContainer");

      // **THAY TH·∫æ URL N√ÄY B·∫∞NG URL Google Apps Script ƒê√É TRI·ªÇN KHAI C·ª¶A B·∫†N**
      const scriptUrl =
        "https://script.google.com/macros/s/AKfycbyOlz9qOG97wmlIW2ahqBhU2GXt8ex4syo7RnFKl8LozIWbWb-OGj4IL3VqXX64FXnJdA/exec";

      // H√†m ƒë·ªçc d·ªØ li·ªáu t·ª´ Apps Script
      async function fetchMeetingData() {
        // Hi·ªÉn th·ªã th√¥ng b√°o ƒëang t·∫£i
        tableContainer.innerHTML =
          '<div class="text-center text-primary"><div class="spinner-border" role="status"></div> ƒêang t·∫£i d·ªØ li·ªáu...</div>';
        tableContainer.style.display = "block";

        try {
          // Y√™u c·∫ßu GET ƒë·ªÉ ƒë·ªçc d·ªØ li·ªáu
          const response = await fetch(scriptUrl);

          // X·ª≠ l√Ω response t·ª´ Apps Script (L∆∞u √Ω: Apps Script tr·∫£ v·ªÅ JSON Text)
          const text = await response.text();
          const data = JSON.parse(text);

          if (data.data && data.data.length > 0) {
            drawTable(data.headers, data.data);
          } else {
            tableContainer.innerHTML =
              '<div class="alert alert-warning text-center">Ch∆∞a c√≥ l·ªãch h·ªçp n√†o ƒë∆∞·ª£c ƒëƒÉng k√Ω.</div>';
          }
        } catch (error) {
          console.error("L·ªói khi t·∫£i d·ªØ li·ªáu:", error);
          tableContainer.innerHTML =
            '<div class="alert alert-danger">L·ªói khi k·∫øt n·ªëi ho·∫∑c ƒë·ªçc d·ªØ li·ªáu. Vui l√≤ng ki·ªÉm tra l·∫°i Apps Script.</div>';
        }
      }

      // H√†m v·∫Ω b·∫£ng HTML/Bootstrap
      function drawTable(headers, data) {
        let tableHTML = `
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-sm">
                    <thead class="table-primary">
                        <tr>
        `;

        // V·∫Ω ti√™u ƒë·ªÅ c·ªôt
        headers.forEach((header) => {
          // L∆∞·ª£c b·ªè c·ªôt 'timestamp' v√† 'noidung' cho b·∫£ng t√≥m t·∫Øt
          if (
            header.toLowerCase() !== "timestamp" &&
            header.toLowerCase() !== "noidung"
          ) {
            tableHTML += `<th>${
              header.charAt(0).toUpperCase() + header.slice(1)
            }</th>`;
          }
        });

        tableHTML += `
                        </tr>
                    </thead>
                    <tbody>
        `;

        // V·∫Ω t·ª´ng h√†ng d·ªØ li·ªáu
        data.forEach((row) => {
          tableHTML += "<tr>";
          headers.forEach((header) => {
            const headerLower = header.toLowerCase();
            // L∆∞·ª£c b·ªè c·ªôt 'timestamp' v√† 'noidung'
            if (headerLower !== "timestamp" && headerLower !== "noidung") {
              // Hi·ªÉn th·ªã ng√†y gi·ªù v√† l√†m ƒë·∫πp
              if (headerLower === "ngaygio") {
                // row[header] ƒë√£ ƒë∆∞·ª£c format ·ªü Apps Script th√†nh "dd-MM-yyyy HH:mm"
                tableHTML += `<td>${row[header]}</td>`;
              } else {
                tableHTML += `<td>${row[header] || ""}</td>`;
              }
            }
          });
          tableHTML += "</tr>";
        });

        tableHTML += `
                    </tbody>
                </table>
            </div>
        `;

        tableContainer.innerHTML = tableHTML;
      }

      // G√°n s·ª± ki·ªán cho n√∫t "Xem L·ªãch H·ªçp"
      viewDataBtn.addEventListener("click", fetchMeetingData);
    </script>
  </body>
</html>
